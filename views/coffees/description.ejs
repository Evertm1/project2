<%- include('../partials/header') %>
<main class="description">
<h1 class="coffee-title"><%= coffee.coffeeName %>, <%= coffee.roaster %></h1>
<img src="/images/genric_coffee.jpg" >
<div class="description-notes">
<section> <strong>Description from roaster: <br> </strong><%= coffee.description %></section>
<section><strong>Tasting notes: <br> </strong><%= coffee.notes %></section>
</div>
<a href="<%=coffee.link %>">Visit Roaster's Site </a>


<h3>Reviews for <%= coffee.coffeeName %></h3>

<% coffee.reviews.forEach(function(c) { %>
    
    <tr>
        <td><%= c.userName %>:</td>
        <td><%= c.text %></td>
        <td><%= c.rating %></td>
        <td><%= c.user %></td>
        <%# console.log(c.userId, user._id) %>
        <% if (user && c.userId === user._id.toString()) { %>
        
         <%# if (c.userId.equals(user._id)) { %>
        <%# if (user && c.userId.equals(user._id)) { %>

        
        <form action="/coffees/description/<%= coffee._id %>/<%=c._id%>?_method=DELETE"
            class="delete-form" method="POST"> 
        <button>Delete</button>
        </form>
        <form action="/coffees/description/<%= coffee._id %>/<%=c._id%>?_method=PUT"
            class="update-form" method="POST">
        <input type="hidden" value="<%=c._id%>" name="id"/>
        <label>Edit Review</label>
        <textarea name="editReviewText"></textarea>
        <label>Edit Rating</label>
        <select name="editRating">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
          </select>
        <button> Save </button><br>
        </form>
        
        <% } %>
        

      </tr>
    
<% }); %>


<form id="add-review-form" method="POST" action="/coffees/description/<%= coffee._id %>">
    <label>Write a review: </label>
    <textarea name="text"></textarea>
    <label>Rating:</label>
    <select name="rating">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
    </select>
    <input type="submit" value="Add Review">
  </form>
</main>
  <%- include('../partials/footer') %>